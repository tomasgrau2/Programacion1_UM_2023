<app-fondo></app-fondo>
<app-nav></app-nav>

<!-- Contenedor principal -->
<div class="main-content">
    <div class="container text-center mt-4 position-relative">
        <div class="row mb-3">
            <button class="btn btn-volver-improved" onclick="window.history.back()">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="text-center mb-3">
            <p class="lead text-center">
                Planificaciones
            </p>
        </div>
    </div>

    <div class="container mt-3">
        <!-- Botón para crear nueva planificación -->
        <div class="d-flex justify-content-center mb-4">
            <button class="btn btn-agregar-planificacion" (click)="openEditModal()">
                <i class="fas fa-plus me-2"></i>
                Nueva Planificación
            </button>
        </div>

        <!-- Lista de planificaciones -->
        <div class="container mt-4 mb-4">
            <div class="d-grid gap-3">
                <div class="planificacion-card" *ngFor="let planificacion of planificaciones">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <div class="planificacion-icon me-3">
                                <i class="fa-solid fa-calendar-week fa-lg"></i>
                            </div>
                            <div class="text-start">
                                <h6 class="mb-1">Planificación #{{planificacion.id}}</h6>
                                <div class="planificacion-days">
                                    <span class="day-badge" *ngFor="let day of ['lunes', 'martes', 'miercoles', 'jueves', 'viernes']">
                                        {{getDayName(day)}}: {{planificacion[day]}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="editar-btn me-2" (click)="openEditModal(planificacion, $event)" title="Editar">
                                <i class="fa-solid fa-edit fa-sm"></i>
                            </div>
                            <div class="eliminar-btn" (click)="deletePlanificacion(planificacion, $event)" title="Eliminar">
                                <i class="fa-solid fa-trash fa-sm"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mensaje cuando no hay planificaciones -->
                <div class="text-center mt-5" *ngIf="planificaciones.length === 0">
                    <i class="fa-solid fa-calendar-xmark fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No hay planificaciones disponibles</p>
                    <button class="btn btn-agregar-planificacion" (click)="openEditModal()">
                        <i class="fas fa-plus me-2"></i>
                        Crear Primera Planificación
                    </button>
                </div>
                
                <!-- Paginación -->
                <nav aria-label="Navegación de páginas" class="d-flex justify-content-center mt-4" *ngIf="totalPaginas > 1">
                    <ul class="pagination pagination-custom">
                        <li class="page-item" [class.disabled]="currentPage <= 1">
                            <a class="page-link" 
                               (click)="currentPage > 1 ? loadPlanificaciones(currentPage - 1) : null"
                               [class.disabled]="currentPage <= 1">
                                <i class="fas fa-chevron-left me-1"></i>
                                Anterior
                            </a>
                        </li>
                        <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
                            <a class="page-link" 
                               (click)="loadPlanificaciones(page)">{{ page }}</a>
                        </li>
                        <li class="page-item" [class.disabled]="currentPage >= totalPaginas">
                            <a class="page-link" 
                               (click)="currentPage < totalPaginas ? loadPlanificaciones(currentPage + 1) : null"
                               [class.disabled]="currentPage >= totalPaginas">
                                Siguiente
                                <i class="fas fa-chevron-right ms-1"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Modal para editar/crear planificación -->
<div class="modal fade" id="editPlanificacionModal" tabindex="-1" aria-labelledby="editPlanificacionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="editPlanificacionModalLabel">
                    {{isCreateMode ? 'Nueva Planificación' : 'Editar Planificación'}}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="editForm" (ngSubmit)="savePlanificacion()">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editLunes" class="form-label">Lunes</label>
                                <input type="text" 
                                       class="form-control bg-dark text-white border-secondary" 
                                       id="editLunes" 
                                       formControlName="lunes"
                                       placeholder="Ej: Tren superior, Libre, Cardio...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editMartes" class="form-label">Martes</label>
                                <input type="text" 
                                       class="form-control bg-dark text-white border-secondary" 
                                       id="editMartes" 
                                       formControlName="martes"
                                       placeholder="Ej: Tren superior, Libre, Cardio...">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editMiercoles" class="form-label">Miércoles</label>
                                <input type="text" 
                                       class="form-control bg-dark text-white border-secondary" 
                                       id="editMiercoles" 
                                       formControlName="miercoles"
                                       placeholder="Ej: Tren superior, Libre, Cardio...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editJueves" class="form-label">Jueves</label>
                                <input type="text" 
                                       class="form-control bg-dark text-white border-secondary" 
                                       id="editJueves" 
                                       formControlName="jueves"
                                       placeholder="Ej: Tren superior, Libre, Cardio...">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editViernes" class="form-label">Viernes</label>
                                <input type="text" 
                                       class="form-control bg-dark text-white border-secondary" 
                                       id="editViernes" 
                                       formControlName="viernes"
                                       placeholder="Ej: Tren superior, Libre, Cardio...">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" (click)="savePlanificacion()" [disabled]="!isFormValid()">
                    {{isCreateMode ? 'Crear' : 'Guardar Cambios'}}
                </button>
            </div>
        </div>
    </div>
</div>

<app-footer></app-footer>